<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Piezo by jsilland</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/jsilland/piezo">View On GitHub</a></li>
          <li class="downloads"><a href="https://github.com/jsilland/piezo/zipball/master">ZIP</a></li>
          <li class="downloads"><a href="https://github.com/jsilland/piezo/tarball/master">TAR</a></li>
          <li class="title">DOWNLOADS</li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>Piezo</h1>
          <p></p>
          <hr>
          <span class="credits left">Project maintained by <a href="https://github.com/jsilland">jsilland</a></span>
          <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></span>
        </div>

        <h1>
<a name="piezo" class="anchor" href="#piezo"><span class="octicon octicon-link"></span></a>Piezo</h1>

<p>Ever wished you could define, implement, deploy and access network services in Java? Well, that's already possible. Ever wished it took 5 minutes? With Piezo, it's a simple as:</p>

<ol>
<li>Define a service in the protocol buffer IDL syntax.</li>
<li>Implement the generated Java interface.</li>
<li>Surface the implementations over, e.g. a vanilla TCP socket. Need to make it available to outside users? Piezo ships with a JSON-RPC implementation over HTTP.</li>
<li>Use it right away! Getting a client stub takes all of two lines of code.</li>
</ol><h2>
<a name="in-more-details" class="anchor" href="#in-more-details"><span class="octicon octicon-link"></span></a>In More Details</h2>

<p>Piezo is a Java RPC stack that combines <a href="https://code.google.com/p/protobuf/">Protocol Buffers</a>, <a href="http://netty.io/">Netty</a> and <a href="https://code.google.com/p/guava-libraries/">Guava</a> in order to provide a state-of-the-art, lightweight, reliable and well-performing channel for deploying and accessing network services.</p>

<p>Piezo is made of two components working hand in hand:</p>

<ul>
<li>A plugin for the Protocol Buffer compiler that generates concrete implementations of protobuf services</li>
<li>A framework that defines a generic RPC abstraction between client and server</li>
<li>Implementations of clients and servers â€” binary/socket based or JSON-RPC/HTTP implementations are available </li>
</ul><p>The Javadoc for the framework is available <a href="http://soliton.io/piezo/apidocs/index.html">here</a>.</p>

<h2>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>Piezo is not yet available in Maven Central, so you'll have to install both the plugin and the framework manually. Both installations require a protocol buffer toolchain to be available (see Usage section below).</p>

<p>In <code>piezo/plugin</code>:</p>

<pre><code>mvn install
</code></pre>

<p>In <code>piezo</code>:</p>

<pre><code>mvn install
</code></pre>

<h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>The following assumes you have working setup of the protocol buffer compiler. Piezo requires version 2.5 of the compiler and framework. Configure a Maven toolchain for your protocol buffer compiler. In <code>~/.m2/toolchains.xml</code>:</p>

<pre><code>&lt;toolchains&gt;
  &lt;toolchain&gt;
    &lt;type&gt;protobuf&lt;/type&gt;
    &lt;provides&gt;
      &lt;version&gt;2.5.0&lt;/version&gt;
    &lt;/provides&gt;
    &lt;configuration&gt;
      &lt;protocExecutable&gt;...&lt;/protocExecutable&gt;
    &lt;/configuration&gt;
  &lt;/toolchain&gt;
&lt;/toolchains&gt;
</code></pre>

<p>Add the Piezo framework, the protocol buffer frameowrk and Guava as dependencies:</p>

<pre><code>&lt;dependencies&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;io.soliton&lt;/groupId&gt;
    &lt;artifactId&gt;piezo&lt;/artifactId&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;com.google.guava&lt;/groupId&gt;
    &lt;artifactId&gt;guava&lt;/artifactId&gt;
    &lt;version&gt;14.0.1&lt;/version&gt;
  &lt;/dependency&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;com.google.protobuf&lt;/groupId&gt;
    &lt;artifactId&gt;protobuf-java&lt;/artifactId&gt;
    &lt;version&gt;2.5.0&lt;/version&gt;
  &lt;/dependency&gt;
&lt;/dependencies&gt;
</code></pre>

<p>Define a protocol buffer service in a file placed under <code>src/main/proto</code>. In the example below, we'll take the example of a DNS service used to resolve domains names into 32-bit IPv4 addresses. Create <code>src/main/proto/your/package/dns.proto</code> with the following contents:</p>

<pre><code>package your.package.dns;

message DnsRequest {
  optional string domain = 1;
}

message DnsResponse {
  optional int32 ip_address = 1;
}

service Dns {
  rpc Resolve (DnsRequest) returns (DnsResponse);
}
</code></pre>

<p>Configure the invocation of the compiler using maven-protoc-plugin:</p>

<pre><code>&lt;pluginRepositories&gt;
  &lt;pluginRepository&gt;
    &lt;id&gt;protoc-plugin&lt;/id&gt;
    &lt;url&gt;http://sergei-ivanov.github.com/maven-protoc-plugin/repo/releases/&lt;/url&gt;
  &lt;/pluginRepository&gt;
&lt;/pluginRepositories&gt;

&lt;plugins&gt;
  &lt;plugin&gt;
    &lt;groupId&gt;com.google.protobuf.tools&lt;/groupId&gt;
    &lt;artifactId&gt;maven-protoc-plugin&lt;/artifactId&gt;
    &lt;version&gt;0.3.1&lt;/version&gt;
    &lt;extensions&gt;true&lt;/extensions&gt;
    &lt;executions&gt;
      &lt;execution&gt;
        &lt;id&gt;Generate proto sources&lt;/id&gt;
        &lt;goals&gt;
          &lt;goal&gt;compile&lt;/goal&gt;
          &lt;goal&gt;testCompile&lt;/goal&gt;
        &lt;/goals&gt;
        &lt;phase&gt;generate-sources&lt;/phase&gt;
        &lt;configuration&gt;
          &lt;protocPlugins&gt;
            &lt;protocPlugin&gt;
              &lt;id&gt;piezo-plugin&lt;/id&gt;
              &lt;groupId&gt;io.soliton&lt;/groupId&gt;
              &lt;artifactId&gt;piezo-plugin&lt;/artifactId&gt;
              &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
              &lt;mainClass&gt;io.soliton.protobuf.plugin.PiezoPlugin&lt;/mainClass&gt;
            &lt;/protocPlugin&gt;
          &lt;/protocPlugins&gt;
        &lt;/configuration&gt;
      &lt;/execution&gt;
    &lt;/executions&gt;
  &lt;/plugin&gt;
&lt;/plugins&gt;
</code></pre>

<p>You should now be able to invoke <code>mvn compile</code> and check the generated code under <code>target/generated-sources</code>. The next step is to create a concrete implementation of the <code>Dns</code> service. The Piezo plugin will have generated an abstract class named <code>Dns</code> with an inner interface named <code>Interface</code>. The concrete implementation will reside on the server. The interface is asynchronous in nature and uses the concurrency facilities provided by Guava:</p>

<pre><code>public class DnsService implements Dns.Interface {
  public ListenableFuture&lt;DnsResponse&gt; resolve(DnsRequest request) {
    return Futures.immediateFuture(DnsResponse.newBuilder().setIpAddress(12435).build());
  }
}
</code></pre>

<p>Instantiate a server and configure it to surface the DNS service:</p>

<pre><code>RpcServer server = new RcpServer(10000); // the server will bind to this port
server.serverGroup().addService(Dns.newService(new DnsService()));
server.start();
</code></pre>

<p>On the client side, instantiate the stub by specifying to which host and port to connect. Then start using the interface as you normally would:</p>

<pre><code>Client transport = new RpcClient(HostAndPort.fromParts("localhost", 10000));
Dns.Interface client = Dns.newStub(transport);
client.resolve("www.google.com").getIpAddress(); // 12345
</code></pre>
      </section>

    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>